# Скрипт для аналізу журналу логів Nginx та конвертування їх у csv файл.

## Методи запуску скрипта:
Загальна команда для запуску скрипта:
```
/bin/bash /home/logs/script.sh /шлях/до/файлу/nginx.log параметр
```
Після запуску скрипта, його результати будуть записані у файл із розширенням .csv, який буде формуватись у директорії, де знаходиться скрипт та автоматично пушитись на Git.
Для кожного із параметрів запуску буде формуватись окремий файл, що буде містити у своїй назві відповідний параметр.
Приклад файлу виводу:
```
analysis_ip.csv
```

### Можливі параметри запуску:
ip - Сортування запитів відбувається за IP адресами користувачів.
uagent - Сортування запитів відбувається за юзер-агентами користувачів.
date - Сортування запитів відбувається за датою.
date+h - Сортування запитів відбувається за датою із урахуванням годин.
date+m - Сортування запитів відбувається за датою із урахуванням годин та хвилин.
date+s - Сортування запитів відбувається за датою із урахуванням годин, хвилин та секунд.
type - Сортування запитів відбувається за типом запиту.
reply - Сортування запитів відбувається за HTTP кодом відповіді.
request -  Сортування запитів відбувається шляхом запиту (URL).
search -  Виконується підрахування певного значення.
Приклад запуску скрипта із параметром search:
```
/bin/bash /home/logs/script.sh /шлях/до/файлу/nginx.log search "ip-address"
```
all - Параметр буде запускати покроково кожен параметр, крім search.

# Опис скрипта:
Скрипт реалізовано на Bash із використанням утиліт awk, sed, sort, uniq та grep для роботи із текстовими даними.

## Методи реалізації скрипта:
Наступний компонент виконує перевірку вірності веденої команди для запуску скрипта:
```
[ -z "$LOG_FILE" ] || [ -z "$MODE" ] && { echo "Usage: $0 <log> <mode>"; exit 1; }
[ ! -f "$LOG_FILE" ] && { echo "Error: $LOG_FILE not found"; exit 1; }

```
Підрахування загальної кількості запитів виконується наступним компонентом:
```
TOTAL_REQ=$(wc -l < "$LOG_FILE")
```
Параметри реалізовані за допомогою центральної функції:
```
run_analysis()
```
 У її рамках додано функції, які будуть виконувати фільтрацію даних за власним параметром, підрахування кількості унікальних значень, сортування їх за кількістю та форматування їх у файл із розширення .csv.

Параметри search та all винесено за рамки центральної функції, оскільки методи їх реалізації відрізняються.

Параметр search реалізовано за допомогою команди grep із ключом -F для виконання точного пошуку, після чого відбувається підрахування кількості знайдених значень за допомогою wc -l.

Параметр all реалізовано через запуск центральної функції 
```
run_analysis()
``` 
Із підставлянням кожного параметру, для покрокового запуску кожного із них.
Даний параметр додано для реалізації можливості автоматизації запуску скрипта за допомогою cron-завдань.

Детальніше ознайомитись із реалізацією скрипта можна у файлу script.sh.
Та із виводом кожного із параметрів у файлі із відповідною назвою analysis_параметр.csv

# Автоматизація через Cron
Приклад додавання у cron-завдання для щоденного аналізу:
```
0 0 * * * /bin/bash /home/logs/script.sh /var/log/nginx/access.log all
```
